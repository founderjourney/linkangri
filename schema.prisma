// Prisma schema for Digitaliza - Optimized for Turso (SQLite)

generator client {
  provider = "prisma-client-js"
}

// Seed configuration
// Run: npm run db:seed

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Restaurant model - Core entity
model Restaurant {
  id          String   @id @default(cuid())
  slug        String   @unique
  name        String
  phone       String
  whatsapp    String
  address     String
  hours       String
  theme       String   @default("japanese") // japanese, italian, mexican, coffee
  password    String
  logoUrl     String?
  description String?
  colors      String?  // JSON string for theme colors

  // Timestamps
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  menuItems   MenuItem[]
  orders      Order[]

  @@map("restaurants")
}

// Menu item model - Performance optimized
model MenuItem {
  id          String    @id @default(cuid())
  name        String
  price       String    // String for flexibility (â‚¬12.50, Market Price, etc.)
  category    String    @default("Principal")
  description String?
  available   Boolean   @default(true)
  imageUrl    String?
  order       Int       @default(0) // For sorting

  // Relations
  restaurantId String
  restaurant   Restaurant @relation(fields: [restaurantId], references: [id], onDelete: Cascade)

  // Timestamps
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Performance indexes
  @@index([restaurantId])
  @@index([restaurantId, available])
  @@index([restaurantId, category])
  @@map("menu_items")
}

// Order tracking (for analytics)
model Order {
  id            String   @id @default(cuid())
  customerName  String
  customerPhone String
  items         String   // JSON string of order items
  total         String
  deliveryType  String   @default("pickup") // pickup, delivery
  preferredTime String?
  notes         String?
  status        String   @default("pending") // pending, confirmed, completed

  // Relations
  restaurantId  String
  restaurant    Restaurant @relation(fields: [restaurantId], references: [id], onDelete: Cascade)

  // Timestamps
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Performance indexes
  @@index([restaurantId])
  @@index([restaurantId, status])
  @@index([createdAt])
  @@map("orders")
}

// Analytics tracking (optional for MVP)
model PageView {
  id           String   @id @default(cuid())
  restaurantId String
  userAgent    String?
  ip           String?
  referrer     String?
  viewedAt     DateTime @default(now())

  // Performance indexes
  @@index([restaurantId])
  @@index([viewedAt])
  @@map("page_views")
}